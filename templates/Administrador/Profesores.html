<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión Docentes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/Profesores.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
  <header class="d-flex align-items-center p-3 border-bottom w-100">
<button class="btn btn-dark" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar">
  <i class="bi bi-list"></i>
</button>
<h2 class="titulo-header mx-4 mb-0">| COLEGIO FE Y ALEGRIA</h2>
<div class="dropdown">
  <button
    class="position-relative"
    type="button"
    id="dropdownMenuButton"
    data-bs-toggle="dropdown"
    aria-expanded="false"
    style="border: none; background: transparent; padding: 0;"
  >
    <i class="bi bi-bell-fill" style="font-size: 1.25rem; margin-left:850px;"></i>
    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
          id="contadorMensajes" style="display:none">0</span>
  </button>
  <ul class="dropdown-menu dropdown-menu-end p-3" style="width: 320px;" aria-labelledby="dropdownMenuButton">
    <li class="text-center text-muted small">Últimas notificaciones</li>
    <div id="notificacionesRecientes" class="mt-2" style="max-height: 200px; overflow-y: auto;">
      <p class="text-center small text-secondary mb-0">Sin notificaciones recientes</p>
    </div>
  </ul>
</div>

<script src="{{ url_for('static', filename='js/notificaciones.js') }}"></script>
</div>

<!--Botón menu de usuario-->

<div class="dropdown">
    <button class="btn btn-usuario dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
      <span class="bi bi-person-circle"></span>
    </button>
    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdownADMIN">
      <li><a class="dropdown-item" href="{{url_for('perfil')}}">Perfil</a></li>
      
      <li><a class="dropdown-item" href="{{url_for('Administrador.configuracion_academica')}}">Configuracion Academica</a></li>
      <li><a class="dropdown-item" href="{{url_for('Administrador.historialacademico')}}">Historial Academico</a></li>

    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="{{url_for('login')}}">Cerrar sesión</a></li>
    </ul>
  </div>

</a>
  </header>

<!--  MENU  -->
<section class="bg-light">
 <div class="offcanvas offcanvas-start text-white" data-bs-backdrop="true" tabindex="-1" id="sidebar">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">MENÚ</h5>
  </div>
  <div class="offcanvas1-body">
    <ul class="nav flex-column">
          <li class="nav-item"><a href="{{ url_for('Administrador.paginainicio') }}" class="nav-link text-white"><i class="bi bi-house-fill"></i> Inicio</a></li>
          
          <a class="nav-link text-white" data-bs-toggle="collapse" href="#submenuNotas"><i class="bi bi-caret-down-fill"></i> Notas</a>
          <div class="collapse" id="submenuNotas">
            <ul class="nav flex-column ms-3">
              <li><a href="{{ url_for('Administrador.notas_consultar') }}" class="nav-link text-white"><i class="bi bi-list-stars"></i> Consultar Notas</a></li>
              
             <li><a href="{{ url_for('Administrador.calculo_promedio') }}" class="nav-link text-white"><i class="bi bi-list-stars"></i> Calculo de Promedio</a></li>

             <li><a href="{{ url_for('Administrador.configuracion_academica') }}" class="nav-link text-white"><i class="bi bi-check-circle-fill"></i> Aprobación Académica</a></li>



            </ul>
          </div>

          <li class="nav-item"><a href="{{ url_for('Administrador.observador') }}" class="nav-link text-white"><i class="bi bi-eye-fill"></i> Observador</a></li>
          <li class="nav-item"><a href="{{ url_for('Administrador.cursos') }}" class="nav-link text-white"><i class="bi bi-inboxes"></i> Cursos</a></li>

          <a class="nav-link text-white" data-bs-toggle="collapse" href="#submenuUsuarios">
            <i class="bi bi-caret-down-fill"></i> Gestión de Usuarios
          </a>
          <div class="collapse" id="submenuUsuarios">
            <ul class="nav flex-column ms-3">
              <li><a href="{{ url_for('Administrador.profesores') }}" class="nav-link text-white"><i class="bi bi-person-fill-gear"></i> Profesores</a></li>
              <li><a href="{{ url_for('Administrador.acudientes') }}" class="nav-link text-white"><i class="bi bi-person-fill"></i> Acudientes</a></li>
              <li><a href="{{ url_for('Administrador.estudiantes') }}" class="nav-link text-white"><i class="bi bi-mortarboard-fill"></i> Estudiantes</a></li>
              <li><a href="{{ url_for('Administrador.repitentes') }}" class="nav-link text-white"><i class="bi bi-person-dash"></i> Lista Estudiantes Repitentes</a></li>
              <li><a href="{{ url_for('Administrador.registro') }}" class="nav-link text-white"><i class="bi bi-people-fill"></i> Registro Usuarios</a></li>
            </ul>
          </div>





          <li class="nav-item"><a href="{{ url_for('Administrador.asignaturas') }}" class="nav-link text-white"><i class="bi bi-journals"></i> Asignatura</a></li>
          <li class="nav-item"><a href="{{ url_for('Administrador.ver_horarios') }}" class="nav-link text-white"><i class="bi bi-globe-americas"></i> Horarios</a></li>
          
        </ul>
      </div>
    </div>
  </div>
</section>

<div id="overlay" class="overlay" onclick="toggleMenu()"></div>

  <main class="container mt-4">
    <h2 class="fw-bold fs-1 text-center mb-4" style="color: #050733;">GESTIÓN DE DOCENTES</h2>

    <div class="card shadow-lg mb-5">
      <div class="card-header" style="background-color: #050733; color: white;">
        <h4 class="mb-0"><i class="bi bi-person-plus me-2"></i>Registrar Nuevo Docente</h4>
      </div>
      <div class="card-body">
        <form id="formDocente" method="POST" action="{{ url_for('Administrador.agregar_docente') }}" class="needs-validation" novalidate>
          
          <div class="row mb-4">
            <div class="col-12">
              <h5 class="fw-bold border-bottom pb-2" style="color: #050733;">
                <i class="bi bi-person-lines-fill me-2"></i>Datos de Identidad
              </h5>
            </div>
          </div>
          
          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Nombres <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-person"></i></span>
                <input type="text" class="form-control" name="Nombre" required>
                <div class="invalid-feedback">
                  Por favor ingrese el nombre del docente.
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Apellidos <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-person"></i></span>
                <input type="text" class="form-control" name="Apellido" required>
                <div class="invalid-feedback">
                  Por favor ingrese los apellidos del docente.
                </div>
              </div>
            </div>
          </div>

          <div class="row g-3 mb-4 border-bottom pb-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Tipo de Documento <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-card-text"></i></span>
                <select class="form-select" name="TipoDocumento" required>
                  <option value="" selected disabled>Seleccione...</option>
                  <option value="CC">Cédula de Ciudadanía</option>
                  <option value="CE">Cédula de Extranjería</option>
                  <option value="TI">Tarjeta de Identidad</option>
                  <option value="PAS">Pasaporte</option>
                </select>
                <div class="invalid-feedback">
                  Por favor seleccione el tipo de documento.
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Número de Documento <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-123"></i></span>
                <input type="text" class="form-control" name="NumeroDocumento" required 
                  pattern="[0-9]{6,12}" title="Ingrese un número de documento válido">
                <div class="invalid-feedback">
                  Por favor ingrese un número de documento válido.
                </div>
              </div>
            </div>
          </div>

          <div class="row mb-4">
            <div class="col-12">
              <h5 class="fw-bold border-bottom pb-2" style="color: #050733;">
                <i class="bi bi-info-circle-fill me-2"></i>Datos de Contacto y Personales
              </h5>
            </div>
          </div>
        
          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Correo Institucional <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                <input type="email" class="form-control" name="Correo" required 
                  pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
                <div class="invalid-feedback">
                  Por favor ingrese un correo institucional válido.
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Teléfono <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-telephone"></i></span>
                <input type="tel" class="form-control" name="Telefono" required
                  pattern="[0-9]{10,15}" title="Ingrese un número de teléfono válido">
                <div class="invalid-feedback">
                  Por favor ingrese un número de teléfono válido.
                </div>
              </div>
            </div>
          </div>

          <div class="row g-3 mb-4 border-bottom pb-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Género <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-gender-ambiguous"></i></span>
                <select class="form-select" name="Genero" required>
                  <option value="" selected disabled>Seleccione...</option>
                  <option value="M">Masculino</option>
                  <option value="F">Femenino</option>
                  <option value="O">Otro</option>
                </select>
                <div class="invalid-feedback">
                  Por favor seleccione el género.
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Dirección</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
                <input type="text" class="form-control" name="Direccion">
              </div>
            </div>
          </div>

          <div class="row mb-4">
            <div class="col-12">
              <h5 class="fw-bold border-bottom pb-2" style="color: #050733;">
                <i class="bi bi-shield-lock-fill me-2"></i>Seguridad y Rol
              </h5>
            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Contraseña <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-key"></i></span>
                <input type="password" id="ContrasenaDocente" name="Contrasena" 
                  class="form-control" required minlength="8"
                  pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                  title="Debe contener al menos un número, una letra mayúscula y minúscula, y al menos 8 caracteres">
                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="ContrasenaDocente">
                  <i class="bi bi-eye"></i>
                </button>
                <div class="invalid-feedback">
                  La contraseña debe tener al menos 8 caracteres, incluyendo mayúsculas, minúsculas y números.
                </div>
              </div>
              <div class="form-text">Mínimo 8 caracteres, con mayúsculas, minúsculas y números.</div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Confirmar Contraseña <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-key-fill"></i></span>
                <input type="password" id="ConfirmarContrasenaDocente" name="ConfirmarContrasena" 
                  class="form-control" required>
                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="ConfirmarContrasenaDocente">
                  <i class="bi bi-eye"></i>
                </button>
                <div class="invalid-feedback">
                  Las contraseñas no coinciden.
                </div>
              </div>
            </div>
          </div>

          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Curso a Dirigir</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-journal-bookmark"></i></span>
                <select name="Curso" id="CursoDocente" class="form-select">
                  <option value="" selected>No asignar como director</option>
                  {% for curso in cursos %}
                    {% set curso_tiene_director = curso.DirectorGrupo is not none %}
                    {% set director_nombre = (curso.director.Nombre|default('') + ' ' + curso.director.Apellido|default(''))|trim if curso.director else '' %}
                    <option value="{{ curso.ID_Curso }}" 
                            data-tiene-director="{{ 'true' if curso_tiene_director else 'false' }}"
                            {% if curso_tiene_director %}data-director-actual="{{ director_nombre }}"{% endif %}>
                      {{ curso.Grado }}° {{ curso.Grupo }}
                      {% if curso_tiene_director %}(Director actual: {{ director_nombre }}){% endif %}
                    </option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <div class="col-md-6"></div> 
          </div>

          <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary px-4" style="background-color: #050733; border-color: #050733;">
              <i class="bi bi-person-plus me-2"></i> Registrar Docente
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script>
    // Validación del formulario
    (function () {
      'use strict'

      // Obtener todos los formularios a los que queremos aplicar estilos de validación de Bootstrap
      var forms = document.querySelectorAll('.needs-validation')

      // Bucle sobre ellos y evitar el envío
      Array.prototype.slice.call(forms)
        .forEach(function (form) {
          form.addEventListener('submit', function (event) {
            // Validar contraseñas coincidentes
            const contrasena = document.getElementById('ContrasenaDocente');
            const confirmarContrasena = document.getElementById('ConfirmarContrasenaDocente');
            
            if (contrasena.value !== confirmarContrasena.value) {
              event.preventDefault();
              event.stopPropagation();
              confirmarContrasena.setCustomValidity('Las contraseñas no coinciden');
              confirmarContrasena.reportValidity();
            } else {
              confirmarContrasena.setCustomValidity('');
            }

            // Validar el formulario
            if (!form.checkValidity()) {
              event.preventDefault()
              event.stopPropagation()
            }

            form.classList.add('was-validated')
          }, false)
        })
    })()

    // Función para mostrar/ocultar contraseña
    document.addEventListener('DOMContentLoaded', function() {
      // Manejar el clic en los botones de mostrar/ocultar contraseña
      document.querySelectorAll('.toggle-password').forEach(function(button) {
        button.addEventListener('click', function() {
          const targetId = this.getAttribute('data-target');
          const input = document.getElementById(targetId);
          const icon = this.querySelector('i');
          
          // Cambiar el tipo de input y el ícono
          if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
          } else {
            input.type = 'password';
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
          }
        });
      });

      // Mostrar advertencia si se selecciona un curso con director
      const selectCurso = document.getElementById('CursoDocente');
      if (selectCurso) {
        selectCurso.addEventListener('change', function() {
          const selectedOption = this.options[this.selectedIndex];
          const tieneDirector = selectedOption.getAttribute('data-tiene-director') === 'true';
          
          if (tieneDirector && this.value !== '') {
            const directorActual = selectedOption.getAttribute('data-director-actual');
            const confirmar = confirm(`¡Atención! Este curso ya tiene un director asignado: ${directorActual}. ¿Desea reemplazarlo?`);
            
            if (!confirmar) {
              this.value = '';
            }
          }
        });
      }
    });
  </script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</body>
</html>
